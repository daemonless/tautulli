#!/bin/sh
# Set up tautulli user and config directory

PUID=${PUID:-1000}
PGID=${PGID:-1000}

echo "[tautulli] Setting up tautulli user with PUID=$PUID PGID=$PGID"

# Only run if manual install version exists
[ -d /app/tautulli ] || exit 0

# Modify tautulli user/group to match requested UID/GID
pw groupmod tautulli -g "$PGID" 2>/dev/null || true

# Create default config if not exists (disable GitHub check for containers without network)
if [ ! -f /config/config.ini ]; then
    echo "[tautulli] Creating default config.ini"
    cat > /config/config.ini << 'EOF'
[General]
check_github_on_startup = 0
EOF
fi

# Ensure directories have correct ownership
chown -R bsd:bsd /config /app/tautulli

echo "[tautulli] Configuration complete"
